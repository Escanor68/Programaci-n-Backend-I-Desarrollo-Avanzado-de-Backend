<div class="product-detail">
    <a href="/products" class="back-link">← Volver a Productos</a>
    
    <div class="detail-container">
        <div class="product-info">
            <h1>{{product.title}}</h1>
            <p class="product-code">Código: {{product.code}}</p>
            <p class="product-description">{{product.description}}</p>
            
            <div class="product-details">
                <div class="detail-item">
                    <strong>Precio:</strong>
                    <span class="price-large">${{product.price}}</span>
                </div>
                <div class="detail-item">
                    <strong>Stock:</strong>
                    <span>{{product.stock}} unidades</span>
                </div>
                <div class="detail-item">
                    <strong>Categoría:</strong>
                    <span>{{product.category}}</span>
                </div>
                <div class="detail-item">
                    <strong>Estado:</strong>
                    <span>{{#if product.status}}Activo{{else}}Inactivo{{/if}}</span>
                </div>
            </div>
            
            {{#if product.thumbnails.length}}
            <div class="product-thumbnails">
                <strong>Imágenes:</strong>
                <div class="thumbnails-list">
                    {{#each product.thumbnails}}
                    <span class="thumbnail-item">{{this}}</span>
                    {{/each}}
                </div>
            </div>
            {{/if}}
            
            <div class="product-actions">
                <button onclick="addToCart('{{product._id}}')" class="btn btn-primary btn-large">
                    Agregar al Carrito
                </button>
            </div>
        </div>
    </div>
</div>

<script>
async function addToCart(productId) {
    try {
        let cartId = localStorage.getItem('cartId');
        
        if (!cartId) {
            const response = await fetch('/api/carts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await response.json();
            cartId = data.data._id;
            localStorage.setItem('cartId', cartId);
        }
        
        const addResponse = await fetch(`/api/carts/${cartId}/product/${productId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });
        
        if (addResponse.ok) {
            alert('Producto agregado al carrito exitosamente');
            window.location.href = `/carts/${cartId}`;
        } else {
            alert('Error al agregar producto al carrito');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al agregar producto al carrito');
    }
}
</script>

<style>
.product-detail {
    max-width: 800px;
    margin: 0 auto;
}

.back-link {
    display: inline-block;
    margin-bottom: 20px;
    color: #667eea;
    text-decoration: none;
    font-weight: bold;
}

.back-link:hover {
    text-decoration: underline;
}

.detail-container {
    background: #f8f9fa;
    padding: 30px;
    border-radius: 8px;
}

.product-info h1 {
    color: #333;
    margin-bottom: 10px;
}

.product-code {
    color: #666;
    margin-bottom: 20px;
}

.product-description {
    font-size: 1.1em;
    line-height: 1.6;
    margin-bottom: 30px;
    color: #555;
}

.product-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 30px;
}

.detail-item {
    padding: 15px;
    background: white;
    border-radius: 5px;
}

.price-large {
    font-size: 2em;
    font-weight: bold;
    color: #28a745;
}

.product-thumbnails {
    margin-bottom: 30px;
}

.thumbnails-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.thumbnail-item {
    padding: 5px 10px;
    background: white;
    border-radius: 3px;
    font-size: 0.9em;
}

.btn-large {
    padding: 15px 30px;
    font-size: 1.2em;
}
</style>
